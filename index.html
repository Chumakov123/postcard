<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ğ¡ĞµĞ»Ñ„Ğ¸â€‘Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ°</title>
    <!-- canvas-confetti Ñ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            background: linear-gradient(145deg, #f9f3e6 0%, #ffe9ce 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .card {
            max-width: 700px;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(8px);
            border-radius: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2), 0 4px 12px rgba(0,0,0,0.1);
            padding: 30px 25px;
            transition: all 0.2s;
        }
        h1, h2 {
            font-weight: 500;
            color: #4a2f1a;
            text-align: center;
            margin-bottom: 20px;
        }
        h1 {
            font-size: 2.2rem;
            letter-spacing: -0.5px;
        }
        h2 {
            font-size: 1.8rem;
        }
        .creator-panel, .card-panel {
            display: none;
            flex-direction: column;
            gap: 20px;
        }
        body.mode-creator .creator-panel {
            display: flex;
        }
        body.mode-card .card-panel {
            display: flex;
        }

        label {
            font-weight: 600;
            color: #5a3e28;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }
        input, textarea, select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid transparent;
            border-radius: 30px;
            font-size: 1rem;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: 0.2s;
            font-family: inherit;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #c89f6e;
            box-shadow: 0 8px 12px rgba(200, 159, 110, 0.2);
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .btn {
            background: #c89f6e;
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 40px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 8px 16px rgba(200, 159, 110, 0.3);
            border: 1px solid rgba(255,255,255,0.3);
            width: fit-content;
            margin: 0 auto;
        }
        .btn:hover {
            background: #b48b5a;
            transform: scale(1.02);
            box-shadow: 0 12px 20px rgba(180, 139, 90, 0.4);
        }
        .btn.secondary {
            background: #e6d5b8;
            color: #4a2f1a;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .btn.secondary:hover {
            background: #dac29c;
        }

        .link-area {
            background: #f2e6d8;
            padding: 15px;
            border-radius: 30px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .link-area input {
            flex: 1;
            background: white;
            padding: 12px 16px;
            border-radius: 40px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }
        .small-btn {
            background: #c89f6e;
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 40px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .video-section {
            display: none; /* Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²Ğ¸Ğ´ĞµĞ¾, Ğ¾Ğ½Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° */
        }
        .photo-section {
            position: relative;
            width: 100%;
            border-radius: 30px;
            overflow: hidden;
            background: #2d2d2d;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            margin-bottom: 10px;
        }
        video, canvas {
            width: 100%;
            height: auto;
            display: block;
        }
        .photo-section {
            display: none; /* Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ²Ñ‚Ğ¾ÑĞ½Ğ¸Ğ¼ĞºĞ° */
        }
        .message-display {
            background: #fff5e6;
            padding: 20px;
            border-radius: 30px;
            font-size: 1.4rem;
            text-align: center;
            font-style: italic;
            color: #3b2c1c;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            word-break: break-word;
        }
        .error-message {
            color: #b34a4a;
            background: #ffe2e2;
            padding: 15px;
            border-radius: 30px;
            text-align: center;
            font-weight: 500;
        }
        .hint-message {
            color: #8b7355;
            background: #fff0d4;
            padding: 15px;
            border-radius: 30px;
            text-align: center;
            font-weight: 500;
            margin-bottom: 10px;
        }
        audio {
            width: 100%;
            border-radius: 30px;
            margin-top: 10px;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        .footer-note {
            text-align: center;
            color: #8b7355;
            font-size: 0.9rem;
        }
        /* Ğ¡Ñ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¾Ğ»Ğ») */
        .emoji-panel {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            gap: 8px;
            padding: 10px 0;
            margin-top: 5px;
            margin-bottom: 5px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: #c89f6e #f2e6d8;
        }
        .emoji-panel::-webkit-scrollbar {
            height: 6px;
        }
        .emoji-panel::-webkit-scrollbar-track {
            background: #f2e6d8;
            border-radius: 10px;
        }
        .emoji-panel::-webkit-scrollbar-thumb {
            background: #c89f6e;
            border-radius: 10px;
        }
        .emoji-btn {
            background: #fff;
            border: none;
            font-size: 1.8rem;
            padding: 8px 12px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: 0.2s;
            line-height: 1;
            flex-shrink: 0;
        }
        .emoji-btn:hover {
            background: #ffe9ce;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="card">
        <!-- Ğ ĞµĞ¶Ğ¸Ğ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ¸ -->
        <div class="creator-panel">
            <h1>âœ¨ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ ÑĞ²Ğ¾Ñ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºÑƒ âœ¨</h1>
            <label for="message">ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ</label>
            <textarea id="message" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ¡ Ğ´Ğ½Ñ‘Ğ¼ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ! Ğ–ĞµĞ»Ğ°Ñ ÑÑ‡Ğ°ÑÑ‚ÑŒÑ..."></textarea>
            
            <!-- ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾Ğ¼ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ (Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ°) -->
            <div class="emoji-panel" id="emojiPanel">
                <!-- Ğ¡Ğ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸ Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸ -->
                <button class="emoji-btn" data-emoji="ğŸ˜Š">ğŸ˜Š</button>
                <button class="emoji-btn" data-emoji="ğŸ˜">ğŸ˜</button>
                <button class="emoji-btn" data-emoji="ğŸ¥°">ğŸ¥°</button>
                <button class="emoji-btn" data-emoji="ğŸ˜˜">ğŸ˜˜</button>
                <button class="emoji-btn" data-emoji="ğŸ˜">ğŸ˜</button>
                <button class="emoji-btn" data-emoji="ğŸ¤©">ğŸ¤©</button>
                <button class="emoji-btn" data-emoji="ğŸ¥³">ğŸ¥³</button>
                <button class="emoji-btn" data-emoji="ğŸ˜¢">ğŸ˜¢</button>
                <button class="emoji-btn" data-emoji="ğŸ˜­">ğŸ˜­</button>
                <button class="emoji-btn" data-emoji="ğŸ˜‚">ğŸ˜‚</button>
                <button class="emoji-btn" data-emoji="ğŸ¤£">ğŸ¤£</button>
                <button class="emoji-btn" data-emoji="ğŸ˜…">ğŸ˜…</button>
                <button class="emoji-btn" data-emoji="ğŸ˜‰">ğŸ˜‰</button>
                <button class="emoji-btn" data-emoji="ğŸ¤”">ğŸ¤”</button>
                <button class="emoji-btn" data-emoji="ğŸ¤—">ğŸ¤—</button>
                <button class="emoji-btn" data-emoji="ğŸ¤­">ğŸ¤­</button>
                <button class="emoji-btn" data-emoji="ğŸ¤«">ğŸ¤«</button>
                <button class="emoji-btn" data-emoji="ğŸ˜´">ğŸ˜´</button>
                <button class="emoji-btn" data-emoji="ğŸ˜ˆ">ğŸ˜ˆ</button>
                <button class="emoji-btn" data-emoji="ğŸ‘»">ğŸ‘»</button>
                <!-- ĞŸÑ€Ğ°Ğ·Ğ´Ğ½Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¸ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ -->
                <button class="emoji-btn" data-emoji="ğŸ‰">ğŸ‰</button>
                <button class="emoji-btn" data-emoji="ğŸŠ">ğŸŠ</button>
                <button class="emoji-btn" data-emoji="ğŸ‚">ğŸ‚</button>
                <button class="emoji-btn" data-emoji="ğŸ°">ğŸ°</button>
                <button class="emoji-btn" data-emoji="ğŸ¾">ğŸ¾</button>
                <button class="emoji-btn" data-emoji="ğŸ¥‚">ğŸ¥‚</button>
                <button class="emoji-btn" data-emoji="ğŸˆ">ğŸˆ</button>
                <button class="emoji-btn" data-emoji="ğŸ">ğŸ</button>
                <button class="emoji-btn" data-emoji="âœ¨">âœ¨</button>
                <button class="emoji-btn" data-emoji="â­">â­</button>
                <button class="emoji-btn" data-emoji="ğŸŒŸ">ğŸŒŸ</button>
                <button class="emoji-btn" data-emoji="ğŸ’«">ğŸ’«</button>
                <button class="emoji-btn" data-emoji="ğŸ”¥">ğŸ”¥</button>
                <button class="emoji-btn" data-emoji="ğŸ’¥">ğŸ’¥</button>
                <button class="emoji-btn" data-emoji="ğŸ’¯">ğŸ’¯</button>
                <!-- Ğ¡ĞµÑ€Ğ´ĞµÑ‡ĞºĞ¸ -->
                <button class="emoji-btn" data-emoji="â¤ï¸">â¤ï¸</button>
                <button class="emoji-btn" data-emoji="ğŸ§¡">ğŸ§¡</button>
                <button class="emoji-btn" data-emoji="ğŸ’›">ğŸ’›</button>
                <button class="emoji-btn" data-emoji="ğŸ’š">ğŸ’š</button>
                <button class="emoji-btn" data-emoji="ğŸ’™">ğŸ’™</button>
                <button class="emoji-btn" data-emoji="ğŸ’œ">ğŸ’œ</button>
                <button class="emoji-btn" data-emoji="ğŸ–¤">ğŸ–¤</button>
                <button class="emoji-btn" data-emoji="ğŸ¤">ğŸ¤</button>
                <button class="emoji-btn" data-emoji="ğŸ’”">ğŸ’”</button>
                <button class="emoji-btn" data-emoji="ğŸ’–">ğŸ’–</button>
                <button class="emoji-btn" data-emoji="ğŸ’">ğŸ’</button>
                <button class="emoji-btn" data-emoji="ğŸ’">ğŸ’</button>
                <!-- Ğ–Ğ¸Ğ²Ğ¾Ñ‚Ğ½Ñ‹Ğµ Ğ¸ Ğ¿Ñ€Ğ¸Ñ€Ğ¾Ğ´Ğ° -->
                <button class="emoji-btn" data-emoji="ğŸ¶">ğŸ¶</button>
                <button class="emoji-btn" data-emoji="ğŸ±">ğŸ±</button>
                <button class="emoji-btn" data-emoji="ğŸ¼">ğŸ¼</button>
                <button class="emoji-btn" data-emoji="ğŸ¨">ğŸ¨</button>
                <button class="emoji-btn" data-emoji="ğŸ¦Š">ğŸ¦Š</button>
                <button class="emoji-btn" data-emoji="ğŸ¸">ğŸ¸</button>
                <button class="emoji-btn" data-emoji="ğŸ§">ğŸ§</button>
                <button class="emoji-btn" data-emoji="ğŸ¤">ğŸ¤</button>
                <button class="emoji-btn" data-emoji="ğŸ£">ğŸ£</button>
                <button class="emoji-btn" data-emoji="ğŸ¦„">ğŸ¦„</button>
                <button class="emoji-btn" data-emoji="ğŸ">ğŸ</button>
                <button class="emoji-btn" data-emoji="ğŸŒ¸">ğŸŒ¸</button>
                <button class="emoji-btn" data-emoji="ğŸŒº">ğŸŒº</button>
                <button class="emoji-btn" data-emoji="ğŸŒ»">ğŸŒ»</button>
                <button class="emoji-btn" data-emoji="ğŸŒ¿">ğŸŒ¿</button>
                <button class="emoji-btn" data-emoji="ğŸ€">ğŸ€</button>
                <!-- Ğ•Ğ´Ğ° -->
                <button class="emoji-btn" data-emoji="ğŸ•">ğŸ•</button>
                <button class="emoji-btn" data-emoji="ğŸ”">ğŸ”</button>
                <button class="emoji-btn" data-emoji="ğŸŸ">ğŸŸ</button>
                <button class="emoji-btn" data-emoji="ğŸŒ­">ğŸŒ­</button>
                <button class="emoji-btn" data-emoji="ğŸ£">ğŸ£</button>
                <button class="emoji-btn" data-emoji="ğŸ¦">ğŸ¦</button>
                <button class="emoji-btn" data-emoji="ğŸ©">ğŸ©</button>
                <button class="emoji-btn" data-emoji="ğŸª">ğŸª</button>
                <button class="emoji-btn" data-emoji="â˜•">â˜•</button>
                <!-- Ğ Ğ°Ğ·Ğ½Ğ¾Ğµ -->
                <button class="emoji-btn" data-emoji="ğŸ‘">ğŸ‘</button>
                <button class="emoji-btn" data-emoji="ğŸ‘">ğŸ‘</button>
                <button class="emoji-btn" data-emoji="ğŸ‘">ğŸ‘</button>
                <button class="emoji-btn" data-emoji="ğŸ™Œ">ğŸ™Œ</button>
                <button class="emoji-btn" data-emoji="ğŸ¤">ğŸ¤</button>
                <button class="emoji-btn" data-emoji="ğŸ‘Š">ğŸ‘Š</button>
                <button class="emoji-btn" data-emoji="âœŒï¸">âœŒï¸</button>
                <button class="emoji-btn" data-emoji="ğŸ’ª">ğŸ’ª</button>
                <button class="emoji-btn" data-emoji="ğŸ‘€">ğŸ‘€</button>
                <button class="emoji-btn" data-emoji="ğŸ‘…">ğŸ‘…</button>
                <button class="emoji-btn" data-emoji="ğŸ’‹">ğŸ’‹</button>
            </div>

            <label for="effect">Ğ­Ñ„Ñ„ĞµĞºÑ‚ Ğ¿Ñ€Ğ¸ ÑĞµĞ»Ñ„Ğ¸</label>
            <select id="effect">
                <option value="confetti" selected>ğŸ‰ ĞšĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸</option>
                <option value="fireworks">ğŸ† Ğ¤ĞµĞ¹ĞµÑ€Ğ²ĞµÑ€Ğº</option>
                <option value="stars">â­ Ğ—Ğ²Ñ‘Ğ·Ğ´Ñ‹</option>
            </select>

            <label for="music">Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ¿ĞµÑĞ½Ñ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</label>
            <input type="url" id="music" placeholder="https://example.com/song.mp3">

            <button class="btn" id="generateLink">ğŸ”— Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºÑƒ</button>

            <div class="link-area" id="linkContainer" style="display: none;">
                <input type="text" id="generatedLink" readonly>
                <button class="small-btn" id="copyLink">ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>
            </div>

            <button class="btn secondary" id="goToCardFromCreator" style="display: none;">ğŸ´ ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞµ</button>
        </div>

        <!-- Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ¸ -->
        <div class="card-panel">
            <h2>ğŸ’Œ Ğ’Ğ°Ğ¼ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ°</h2>
            <div class="message-display" id="cardMessage"></div>

            <!-- Ğ’Ğ¸Ğ´ĞµĞ¾ ÑĞºÑ€Ñ‹Ñ‚Ğ¾, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ·Ğ°Ñ…Ğ²Ğ°Ñ‚Ğ° -->
            <div class="video-section">
                <video id="video" autoplay playsinline></video>
            </div>

            <!-- ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ° Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼ ĞºĞ°Ğ¼ĞµÑ€Ñ‹ -->
            <div id="cameraHint" class="hint-message" style="display: none;">ĞŸÑ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¸Ñ‰ Ğ¼Ğ°Ğ¹Ğ¾Ñ€ Ğ¼Ğ¾Ğ³ Ğ»ÑƒÑ‡ÑˆĞµ Ğ²Ğ°Ñ Ñ€Ğ°Ğ·Ğ³Ğ»ÑĞ´ĞµÑ‚ÑŒ</div>

            <!-- Ğ‘Ğ»Ğ¾Ğº Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ ĞºĞ°Ğ¼ĞµÑ€Ñ‹ -->
            <div id="cameraError" class="error-message" style="display: none;"></div>

            <!-- Ğ¡Ğ´ĞµĞ»Ğ°Ğ½Ğ½Ğ¾Ğµ Ñ„Ğ¾Ñ‚Ğ¾ (Ğ¿Ğ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ²Ñ‚Ğ¾ÑĞ½Ğ¸Ğ¼ĞºĞ°) -->
            <div class="photo-section" id="photoSection">
                <canvas id="photoCanvas"></canvas>
            </div>

            <!-- ĞÑƒĞ´Ğ¸Ğ¾Ğ¿Ğ»ĞµĞµÑ€ (Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ music) -->
            <div id="audioContainer"></div>

            <!-- <div class="btn-group">
                <button class="btn secondary" id="retakePhotoBtn" style="display: none;">ğŸ”„ Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğµ ÑĞµĞ»Ñ„Ğ¸</button>
            </div> -->

            <button class="btn secondary" id="backToCreatorBtn">ğŸ’ Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºÑƒ</button>
        </div>
    </div>

    <script>
        (function() {
            // --- Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ DOM ---
            const body = document.body;
            const creatorPanel = document.querySelector('.creator-panel');
            const cardPanel = document.querySelector('.card-panel');

            // Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ
            const messageInput = document.getElementById('message');
            const effectSelect = document.getElementById('effect');
            const musicInput = document.getElementById('music');
            const generateBtn = document.getElementById('generateLink');
            const linkContainer = document.getElementById('linkContainer');
            const generatedLinkInput = document.getElementById('generatedLink');
            const copyBtn = document.getElementById('copyLink');
            const goToCardBtn = document.getElementById('goToCardFromCreator');

            // Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ¸
            const cardMessageDiv = document.getElementById('cardMessage');
            const video = document.getElementById('video');
            const photoSection = document.getElementById('photoSection');
            const photoCanvas = document.getElementById('photoCanvas');
            const cameraHint = document.getElementById('cameraHint');
            const cameraErrorDiv = document.getElementById('cameraError');
            const audioContainer = document.getElementById('audioContainer');
            //const retakePhotoBtn = document.getElementById('retakePhotoBtn');
            const backToCreatorBtn = document.getElementById('backToCreatorBtn');

            // --- Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ ---
            let currentStream = null;
            let effectParam = 'confetti';
            let musicParam = '';
            let effectInterval = null;   // Ğ´Ğ»Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑÑ„Ñ„ĞµĞºÑ‚Ğ°
            let autoPhotoTaken = false;  // Ñ„Ğ»Ğ°Ğ³ Ğ´Ğ»Ñ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ²Ğ¾Ğ¹Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ğ²Ñ‚Ğ¾ÑĞ½Ğ¸Ğ¼ĞºĞ°

            // --- Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ² URL ---
            function getUrlParams() {
                const params = new URLSearchParams(window.location.search);
                return {
                    message: params.get('message') || '',
                    effect: params.get('effect') || 'confetti',
                    music: params.get('music') || ''
                };
            }

            // --- Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ ---
            function setMode(mode) {
                if (mode === 'creator') {
                    body.classList.remove('mode-card');
                    body.classList.add('mode-creator');
                } else {
                    body.classList.remove('mode-creator');
                    body.classList.add('mode-card');
                }
            }

            // --- ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞºĞ°Ğ¼ĞµÑ€Ñ‹ ---
            function stopCamera() {
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                    currentStream = null;
                }
            }

            // --- ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑÑ„Ñ„ĞµĞºÑ‚Ğ° ---
            function stopEffect() {
                if (effectInterval) {
                    clearInterval(effectInterval);
                    effectInterval = null;
                }
            }

            // --- Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑÑ„Ñ„ĞµĞºÑ‚Ğ°: ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ + ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğµ Ğ²Ğ·Ñ€Ñ‹Ğ²Ñ‹ ---
            function startContinuousEffect(effectType) {
                stopEffect(); // Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğ¹

                // Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ° confetti Ñ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¼ x
                const fire = (options = {}) => {
                    confetti({
                        ...options,
                        origin: {
                            x: options.origin?.x ?? Math.random(), // ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ x, ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½
                            y: options.origin?.y ?? 0
                        },
                        spread: options.spread || 100,
                    });
                };

                switch (effectType) {
                    case 'fireworks':
                        // ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 400 Ğ¼Ñ: Ğ¾Ğ´Ğ¸Ğ½ Ğ·Ğ°Ğ»Ğ¿ ÑĞ²ĞµÑ€Ñ…Ñƒ, Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ğ·Ñ€Ñ‹Ğ² Ğ² ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
                        effectInterval = setInterval(() => {
                            // ÑĞ²ĞµÑ€Ñ…Ñƒ
                            fire({
                                particleCount: 30,
                                spread: 90,
                                startVelocity: 35,
                                colors: ['#ff4d4d', '#ff9f4d', '#ffff4d', '#4dff4d', '#4dffff', '#4d4dff'],
                                origin: { y: 0 }
                            });
                            // ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ğ²Ğ·Ñ€Ñ‹Ğ²
                            fire({
                                particleCount: 60,
                                spread: 120,
                                startVelocity: 40,
                                colors: ['#ff4d4d', '#ff9f4d', '#ffff4d', '#4dff4d', '#4dffff', '#4d4dff'],
                                origin: { y: 0.2 + Math.random() * 0.6 } // Ğ² Ñ†ĞµĞ½Ñ‚Ñ€Ğµ Ğ¸Ğ»Ğ¸ Ğ½Ğ¸Ğ¶Ğ½ĞµĞ¹ Ñ‡Ğ°ÑÑ‚Ğ¸
                            });
                        }, 400);
                        break;
                    case 'stars':
                        effectInterval = setInterval(() => {
                            // Ğ¼ĞµÑ€Ñ†Ğ°ÑÑ‰Ğ¸Ğµ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ ÑĞ²ĞµÑ€Ñ…Ñƒ
                            fire({
                                particleCount: 20,
                                spread: 80,
                                colors: ['#FFE55C', '#FFD700', '#FFFFFF', '#B0E0E6'],
                                shapes: ['circle'],
                                startVelocity: 15,
                                gravity: 0.2,
                                origin: { y: 0 }
                            });
                            // Ğ²ÑĞ¿Ñ‹ÑˆĞºĞ° Ğ·Ğ²Ñ‘Ğ·Ğ´ Ğ² ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
                            fire({
                                particleCount: 40,
                                spread: 100,
                                colors: ['#FFE55C', '#FFD700', '#FFFFFF', '#B0E0E6'],
                                shapes: ['circle'],
                                startVelocity: 25,
                                gravity: 0.4,
                                origin: { y: 0.2 + Math.random() * 0.6 }
                            });
                        }, 300);
                        break;
                    case 'confetti':
                    default:
                        effectInterval = setInterval(() => {
                            // Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾Ğµ ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸ ÑĞ²ĞµÑ€Ñ…Ñƒ
                            fire({
                                particleCount: 40,
                                spread: 80,
                                colors: ['#f2d74e', '#95c3fa', '#ff9a9a', '#b0f0b0', '#d8b4ff'],
                                startVelocity: 25,
                                gravity: 0.5,
                                origin: { y: 0 }
                            });
                            // Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ²ÑĞ¿Ñ‹ÑˆĞºĞ° ĞºĞ¾Ğ½Ñ„ĞµÑ‚Ñ‚Ğ¸ Ğ² ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ğ¾Ğ¼ Ğ¼ĞµÑÑ‚Ğµ
                            fire({
                                particleCount: 30,
                                spread: 110,
                                colors: ['#f2d74e', '#95c3fa', '#ff9a9a', '#b0f0b0', '#d8b4ff'],
                                startVelocity: 30,
                                gravity: 0.7,
                                origin: { y: 0.2 + Math.random() * 0.6 }
                            });
                        }, 300);
                        break;
                }
            }

            // --- Ğ—Ğ°Ñ…Ğ²Ğ°Ñ‚ Ñ„Ğ¾Ñ‚Ğ¾ Ñ Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¸ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ„Ğ¾Ñ‚Ğ¾-Ñ€ĞµĞ¶Ğ¸Ğ¼ ---
            function takePhoto() {
                if (!video.videoWidth) return;

                const ctx = photoCanvas.getContext('2d');
                photoCanvas.width = video.videoWidth;
                photoCanvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0, photoCanvas.width, photoCanvas.height);

                // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ„Ğ¾Ñ‚Ğ¾
                photoSection.style.display = 'block';
                //retakePhotoBtn.style.display = 'inline-block';

                // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¿Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ñ‹Ğ¹ ÑÑ„Ñ„ĞµĞºÑ‚ (ÑĞ²ĞµÑ€Ñ…Ñƒ + Ğ²Ğ·Ñ€Ñ‹Ğ²Ñ‹)
                startContinuousEffect(effectParam);
            }

            // --- ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğº Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¼Ñƒ ÑĞµĞ»Ñ„Ğ¸ ---
            function retakePhoto() {
                // ĞÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑÑ„Ñ„ĞµĞºÑ‚, ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ„Ğ¾Ñ‚Ğ¾
                stopEffect();
                photoSection.style.display = 'none';
                //retakePhotoBtn.style.display = 'none';
                autoPhotoTaken = false; // Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞ°ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾ÑĞ½Ğ¸Ğ¼Ğ¾Ğº

                // Ğ’Ğ¸Ğ´ĞµĞ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾, Ğ½Ğ¾ ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ñ‚Ğ¾Ğº Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ» â€“ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ğ¼ ĞºĞ°Ğ¼ĞµÑ€Ñƒ
                if (!currentStream || !currentStream.active) {
                    startCamera().then(() => waitForVideoAndTakePhoto());
                } else {
                    waitForVideoAndTakePhoto();
                }
            }

            // --- ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾ÑĞ½Ğ¸Ğ¼Ğ¾Ğº ---
            function waitForVideoAndTakePhoto() {
                if (video.videoWidth > 0 && video.videoHeight > 0) {
                    if (!autoPhotoTaken) {
                        takePhoto();
                        autoPhotoTaken = true;
                    }
                } else {
                    video.addEventListener('loadeddata', function onLoaded() {
                        video.removeEventListener('loadeddata', onLoaded);
                        if (!autoPhotoTaken) {
                            setTimeout(() => {
                                takePhoto();
                                autoPhotoTaken = true;
                            }, 100);
                        }
                    });
                }
            }

            // --- Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ°Ğ¼ĞµÑ€Ñ‹ (Ğ²Ğ¸Ğ´ĞµĞ¾ ÑĞºÑ€Ñ‹Ñ‚Ğ¾) ---
            async function startCamera() {
                stopCamera();
                // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºÑƒ Ğ¿ĞµÑ€ĞµĞ´ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼
                cameraHint.style.display = 'block';
                cameraErrorDiv.style.display = 'none';
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                    currentStream = stream;
                    video.srcObject = stream;
                    // ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ° â€“ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºÑƒ ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼
                    cameraHint.style.display = 'none';
                } catch (err) {
                    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ°Ğ¼ĞµÑ€Ñ‹:', err);
                    cameraErrorDiv.style.display = 'block';
                    cameraErrorDiv.textContent = 'ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ.';
                    cameraHint.style.display = 'none'; // Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºÑƒ Ñ‚Ğ¾Ğ¶Ğµ ÑƒĞ±Ğ¸Ñ€Ğ°ĞµĞ¼
                }
            }

            // --- Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²ĞµĞ´ĞµĞ½Ğ¸Ñ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸ ---
            function tryAutoplayAudio(audioElement) {
                if (!audioElement) return;
                setTimeout(() => {
                    audioElement.play().catch(e => {
                        console.log('Autoplay Ğ½Ğµ ÑÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ½Ğ°Ğ¶Ğ°Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ):', e);
                    });
                }, 300);
            }

            // --- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ¸ ---
            async function initCardMode() {
                const params = getUrlParams();
                cardMessageDiv.textContent = params.message || 'ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑÑ!';
                effectParam = params.effect;
                musicParam = params.music;

                // ĞŸĞ»ĞµĞµÑ€ Ğ´Ğ»Ñ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸ Ñ autoplay
                audioContainer.innerHTML = '';
                if (musicParam) {
                    const audio = document.createElement('audio');
                    audio.controls = true;
                    audio.autoplay = true;
                    audio.src = musicParam;
                    audioContainer.appendChild(audio);
                    tryAutoplayAudio(audio);
                }

                // Ğ¡Ğ±Ñ€Ğ¾Ñ UI
                photoSection.style.display = 'none';
                //retakePhotoBtn.style.display = 'none';
                stopEffect();
                autoPhotoTaken = false;
                cameraHint.style.display = 'none';
                cameraErrorDiv.style.display = 'none';

                // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ ĞºĞ°Ğ¼ĞµÑ€Ñƒ (Ğ²Ğ¸Ğ´ĞµĞ¾ ÑĞºÑ€Ñ‹Ñ‚Ğ¾)
                await startCamera();

                // Ğ•ÑĞ»Ğ¸ ĞºĞ°Ğ¼ĞµÑ€Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ°, Ğ¶Ğ´Ñ‘Ğ¼ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ğ°Ğ²Ñ‚Ğ¾ÑĞ½Ğ¸Ğ¼Ğ¾Ğº
                if (cameraErrorDiv.style.display !== 'block') {
                    waitForVideoAndTakePhoto();
                }
            }

            // --- Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑÑÑ‹Ğ»ĞºĞ¸ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ---
            function generateLink() {
                const message = messageInput.value.trim();
                const effect = effectSelect.value;
                const music = musicInput.value.trim();

                const params = new URLSearchParams();
                if (message) params.set('message', message);
                params.set('effect', effect);
                if (music) params.set('music', music);

                const url = window.location.origin + window.location.pathname + '?' + params.toString();
                generatedLinkInput.value = url;
                linkContainer.style.display = 'flex';
                goToCardBtn.style.display = 'inline-block';
            }

            // --- ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑÑ‹Ğ»ĞºĞ¸ ---
            function copyLink() {
                generatedLinkInput.select();
                navigator.clipboard?.writeText(generatedLinkInput.value).then(() => {
                    alert('Ğ¡ÑÑ‹Ğ»ĞºĞ° ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°!');
                }).catch(() => {
                    alert('ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ctrl+C');
                });
            }

            // --- ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğº Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞµ Ğ¿Ğ¾ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑÑÑ‹Ğ»ĞºĞµ ---
            function goToCard() {
                if (generatedLinkInput.value) {
                    window.location.href = generatedLinkInput.value;
                }
            }

            // --- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ (Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¾Ğ²) ---
            function backToCreator() {
                stopEffect();
                stopCamera();
                window.location.href = window.location.origin + window.location.pathname;
            }

            // --- Ğ’ÑÑ‚Ğ°Ğ²ĞºĞ° ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ² textarea ---
            function insertEmoji(emoji) {
                const start = messageInput.selectionStart;
                const end = messageInput.selectionEnd;
                const text = messageInput.value;
                const newText = text.substring(0, start) + emoji + text.substring(end);
                messageInput.value = newText;
                // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ĞºÑƒÑ€ÑĞ¾Ñ€Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ²ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸
                messageInput.selectionStart = messageInput.selectionEnd = start + emoji.length;
                messageInput.focus();
            }

            // --- Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ---
            function init() {
                const params = getUrlParams();
                if (params.message || params.effect !== 'confetti' || params.music) {
                    setMode('card');
                    initCardMode().catch(console.error);
                } else {
                    setMode('creator');
                    messageInput.value = '';
                    effectSelect.value = 'confetti';
                    musicInput.value = '';
                    linkContainer.style.display = 'none';
                    goToCardBtn.style.display = 'none';
                }

                // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸
                document.querySelectorAll('.emoji-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const emoji = btn.getAttribute('data-emoji');
                        insertEmoji(emoji);
                    });
                });
            }

            // --- Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ ---
            generateBtn.addEventListener('click', generateLink);
            copyBtn.addEventListener('click', copyLink);
            goToCardBtn.addEventListener('click', goToCard);
            backToCreatorBtn.addEventListener('click', backToCreator);
            //retakePhotoBtn.addEventListener('click', retakePhoto);

            // Ğ¡Ñ‚Ğ°Ñ€Ñ‚
            init();

            // ĞŸÑ€Ğ¸ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğµ Ğ¸Ğ· Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ĞºĞ¸ Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²ÑÑ‘
            window.addEventListener('beforeunload', function() {
                stopEffect();
                stopCamera();
            });
        })();
    </script>
</body>
</html>